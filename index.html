<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="refresh" content="1800" />
  <title>Dedicatorias - Feria de las Flores</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      background-color: black;
      font-family: 'Arial', sans-serif;
      position: relative;
    }
    video.fondoVideo {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: fill; /* Requerido para Gran Estación */
      z-index: -1;
      opacity: 0;
      transition: opacity 0.5s ease;
    }
    video.fondoVideo.activo {
      opacity: 1;
    }
    .contenedor {
      width: 100%;
      height: 100%;
      position: relative;
    }
    .de, .para {
      position: absolute;
      font-size: 230px;
      font-weight: bold;
      text-shadow: 0px 0px 0px rgba(0,0,0,0.6);
      color: white;
      transition: color 0.5s ease;
    }
    .de {
      top: 600px;
      left: 1700px;
    }
    .para {
      bottom: 1700px;
      right: 900px;
    }
  </style>
</head>
<body>

  <!-- VIDEOS PRE-CARGADOS -->
  <video id="girasol" class="fondoVideo activo" autoplay muted playsinline loop>
    <source src="girasol.mp4" type="video/mp4">
  </video>
  <video id="rosa" class="fondoVideo" autoplay muted playsinline loop>
    <source src="rosa.mp4" type="video/mp4">
  </video>
  <video id="orquidea" class="fondoVideo" autoplay muted playsinline loop>
    <source src="orquidea.mp4" type="video/mp4">
  </video>
  <video id="margarita" class="fondoVideo" autoplay muted playsinline loop>
    <source src="margarita.mp4" type="video/mp4">
  </video>
  <video id="clavel" class="fondoVideo" autoplay muted playsinline loop>
    <source src="clavel.mp4" type="video/mp4">
  </video>

  <div class="contenedor">
    <div id="de" class="de">Cargando...</div>
    <div id="para" class="para">dedicatorias</div>
  </div>

  <script>
    const URL = "https://script.google.com/macros/s/AKfycbzjWEco_1WTKoP82WQYxTDPrjVwE2SLwrzzr-760Ap2cingRJVBLBFolUJmoz0ZxKSf0w/exec";
    let dedicatorias = [];
    let index = 0;

    const deEl = document.getElementById("de");
    const paraEl = document.getElementById("para");

    const coloresPorFlor = {
      "girasol.mp4": "#025100",
      "rosa.mp4": "#4f0035",
      "orquidea.mp4": "#004f40",
      "margarita.mp4": "#4f3a00",
      "clavel.mp4": "#000f4f"
    };

    const videos = {
      "girasol.mp4": document.getElementById("girasol"),
      "rosa.mp4": document.getElementById("rosa"),
      "orquidea.mp4": document.getElementById("orquidea"),
      "margarita.mp4": document.getElementById("margarita"),
      "clavel.mp4": document.getElementById("clavel")
    };

    function ocultarTodosLosVideos() {
      Object.values(videos).forEach(video => video.classList.remove("activo"));
    }

    function mostrarDedicatoria() {
      const item = dedicatorias[index];

      // Normalizar nombre de fondo
      let fondo = (item.fondo || "").trim().toLowerCase();
      if (!fondo.endsWith(".mp4")) fondo += ".mp4";

      // Asignar texto con protección por si faltan datos
      deEl.textContent = item.de || "Sin remitente";
      paraEl.textContent = item.para || "Sin destinatario";

      // Mostrar video correspondiente
      ocultarTodosLosVideos();
      if (videos[fondo]) {
        videos[fondo].classList.add("activo");
      } else {
        console.warn(`No se encontró video para: ${fondo}, usando girasol.mp4 por defecto`);
        videos["girasol.mp4"].classList.add("activo");
      }

      // Cambiar color de texto según flor
      const color = coloresPorFlor[fondo] || "#ffffff";
      deEl.style.color = color;
      paraEl.style.color = color;

      index = (index + 1) % dedicatorias.length;
    }

    async function cargarDatos() {
      try {
        const res = await fetch(URL);
        const datos = await res.json();
        dedicatorias = datos.sort(() => Math.random() - 0.5);
        if (dedicatorias.length === 0) {
          deEl.textContent = "Aún no hay";
          paraEl.textContent = "dedicatorias";
          return;
        }
        mostrarDedicatoria();
        setInterval(mostrarDedicatoria, 7000);
      } catch (error) {
        deEl.textContent = "Error";
        paraEl.textContent = "al cargar datos";
        console.error(error);
      }
    }

    cargarDatos();
  </script>
</body>
</html>